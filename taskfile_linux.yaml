---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

vars:
  packages: ansible ansible-lint awscli btop build-essential fzf git glances golang jq kubecolor kubectx kubetail libbz2-dev libffi-dev libgdbm-dev libncurses5-dev libnss3-dev libreadline-dev libsqlite3-dev libssl-dev netcat-openbsd neofetch neovim nmap podman python3 rsync software-properties-common stow thefuck tldr tmux wget zlib1g-dev zoxide zsh

tasks:
  default:
    deps:
      - upgrade
      - install
      - install-kubectl

  upgrade:
    desc: Upgrade OS and installed packages
    cmds:
      - apt update
      - apt upgrade -y

  install:
    desc: Install packages
    cmds:
      - apt install -y {{.packages}}

  install-kubectl:
    desc: Procure kubectl binary
    vars:
      version:
        sh: curl -L -s https://dl.k8s.io/release/stable.txt
      os:
        sh: uname -s | tr '[:upper:]' '[:lower:]'
      arch:
        sh: dpkg --print-architecture
    cmds:
      - curl -LO "https://dl.k8s.io/release/{{.version}}/bin/{{.os}}/{{.arch}}/kubectl"
      - install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
      - rm -f ./kubectl
    generates:
      - /usr/local/bin/kubectl
    preconditions:
      - command -v curl
      - command -v install
    status:
      - test -x /usr/local/bin/kubectl
