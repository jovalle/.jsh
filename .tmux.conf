# Legacy Compatibility
# ------------------------------------------------------------
run-shell 'tmux setenv -g TMUX_VERSION $(tmux -V | sed -En "s/^tmux ([1-9]+(.[0-9]+)?).*/\1/p")'

if-shell -b '[ "$(echo "$TMUX_VERSION < 2.1" | bc)" = 1 ]' " \
 set -g mouse-resize-pane on; \
 set -g mouse-select-pane on; \
 set -g mouse-select-window on; \
 set -g mode-mouse on; \
 set-option -g pane-active-border-fg '#ffa827'"

if-shell -b '[ "$(echo "$TMUX_VERSION > 2.0" | bc)" = 1 ]' " \
 set -g mouse on; \
 set-option -g pane-active-border-style 'fg=#ffa827'"


# Session options
# ------------------------------------------------------------

# Set default shell
set-option -g default-shell $SHELL

# Change bind key to ctrl-a
unbind c-b
set -g prefix c-a

# Additional prefix for `
set -g prefix2 '`'
bind-key '`' send-prefix -2

# Update status line every X seconds
set -g status-interval 1

# Index starts from 1
set -g base-index 1
set -g pane-base-index 1

# Renumber windows when a window is closed
set -g renumber-windows on

# History
set -g history-limit 102400

# Repeat time limit (ms)
set -g repeat-time 500

# Faster command sequences
set -g escape-time 0

# 256-color terminal
set -g default-terminal "xterm-256color"

## Override terminal option
#set -g terminal-overrides 'xterm:colors=256'

# Activity
set -g monitor-activity no

# Enable vi
set-window-option -g mode-keys vi


# Window options
# ------------------------------------------------------------

# Additional key mapping functionality
set-window-option -g xterm-keys on

# Disable auto-renaming
set -g allow-rename off
set-window-option -g automatic-rename off


# Key bindings
# ------------------------------------------------------------
# prefix c
bind-key c new-window -c -

# prefix ctrl-a
bind-key c-a last-window

# prefix a
bind-key a send-prefix

# prefix _
bind-key _ split-window -h -c -

# prefix -
bind-key - split-window -c -

# find
bind-key -n C-f copy-mode \; send-key ?

# cycle through layouts
bind-key -n 'C-\' next-layout

# Global window switching
bind-key -n M-[ previous-window
bind-key -r [ previous-window
bind-key -n M-] next-window
bind-key -r ] next-window

# Pane-movement
bind-key -n M-h select-pane -L
bind-key -r h select-pane -L
bind-key -n M-j select-pane -D
bind-key -r j select-pane -D
bind-key -n M-k select-pane -U
bind-key -r k select-pane -U
bind-key -n M-l select-pane -R
bind-key -r l select-pane -R

# Pane resizing
bind-key -n C-M-h resize-pane -L 2
bind-key -r H resize-pane -L 2
bind-key -n C-M-j resize-pane -D 2
bind-key -r J resize-pane -D 2
bind-key -n C-M-k resize-pane -U 2
bind-key -r K resize-pane -U 2
bind-key -n C-M-l resize-pane -R 2
bind-key -r L resize-pane -R 2

# Tmux controls
bind-key x kill-pane
bind-key X kill-window
bind-key C-X kill-server

# Synchronize panes
bind-key * set-window-option synchronize-pane

# Edit ~/.tmux.conf
bind-key e new-window -n '~/.tmux.conf' "sh -c '\${EDITOR:-vim} ~/.tmux.conf.local && tmux source ~/.tmux.conf && tmux display \"~/.tmux.conf sourced\"'"

# Reload ~/.tmux.conf
bind-key r source-file ~/.tmux.conf \; display-message "Reloaded!"

# Restart pane
bind-key R respawn-pane -k

# Preserve current path on new
bind-key % split-window -h -c "#{pane_current_path}"
bind-key '"' split-window -v -c "#{pane_current_path}"
bind-key c new-window -c "#{pane_current_path}"

# Capture pane and open in Vim
bind-key C-c run 'FILE=/tmp/tmux-capture-$(date +%Y%m%d%H%M%S).txt; tmux capture-pane -J -S -102400 -p > $FILE; tmux new-window "reattach-to-user-namespace vim $FILE"'
bind-key M-c run "screencapture -l$(osascript -e 'tell app \"iTerm\" to id of window 1') -x -o -P /tmp/$(date +%Y%m%d-%H%M%S).png"

# Clear scrollback buffer
bind-key C-l send-keys C-l \; clear-history

# Color key:
#   #1d1f21 Background
#   #282a2e Current Line
#   #373b41 Selection
#   #c6c8c6 Foreground
#   #969896 Comment
#   #cc6666 Red
#   #de935f Orange
#   #f0c674 Yellow
#   #b5bd68 Green
#   #8abeb7 Aqua
#   #81a2be Blue
#   #b294bb Purple

# set clock mode
set -g clock-mode-colour "#ffa827"
set -g clock-mode-style 24

# set status bar
set -g status-bg default

# tabs of status bar
setw -g window-status-format "#[bg=#default]#[fg=#222222] #I #[bg=default]#[fg=#666666] #W "
setw -g window-status-current-format "#[bg=#222222]#[fg=cyan,bold] #I#[fg=white,bold] #[bg=#222222]#W#[fg=cyan]* "

# left side of status bar
#set -g status-left '#[fg=#e0e0e0,bg=#111111][#{session_name}] #[fg=blue]#I#[fg=white]:#[fg=yellow]#P '
set -g status-left ''

# right side of status bar holds "[host name] (date time)"
set -g status-right-length 100
set -g status-right '#[fg=#666666,bg=default] #H #[fg=white,bg=#222222] %h %d %H:%M '
