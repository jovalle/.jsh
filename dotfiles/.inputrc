# ==============================================================================
# Readline Configuration (.inputrc)
# ==============================================================================
# Merged from top dotfiles and GNU Readline best practices:
# - topbug.net's "inputrc for Humans"
# - Rican7/dotfiles (decade of tuning)
# - deut-erium's vi mode configuration
# - GNU Readline documentation
# - Various GitHub dotfiles repositories
#
# This file configures GNU Readline, the line-editing library used by:
# - Bash shell
# - Python REPL
# - MySQL/PostgreSQL clients
# - Node.js REPL
# - Ruby IRB
# - And many other CLI applications
#
# Organization:
#   1. Meta Settings - Include and apply rules
#   2. Editing Mode - Vi or Emacs keybindings
#   3. Completion - Tab completion behavior
#   4. Display - Visual feedback and appearance
#   5. History - Command history navigation
#   6. Key Bindings - Custom keyboard shortcuts
#   7. Vi Mode - Vi-specific settings
# ==============================================================================

# ==============================================================================
# 1. META SETTINGS
# ==============================================================================

# Include system-wide configuration first
# This ensures we inherit any distro-specific settings
$include /etc/inputrc

# ==============================================================================
# 2. EDITING MODE
# ==============================================================================

# Use Vi editing mode (shell agnostic, works everywhere)
# Change to 'emacs' if you prefer Emacs-style keybindings
set editing-mode vi

# ==============================================================================
# 3. COMPLETION SETTINGS
# ==============================================================================

# Case-insensitive completion
# 'cd dow' will match 'Downloads', 'downloads', 'DOWNLOADS'
set completion-ignore-case on

# Treat hyphens and underscores as equivalent
# 'some_command' matches 'some-command' and vice versa
set completion-map-case on

# Show all completions immediately if input is ambiguous
# Instead of requiring double-Tab, shows options on first Tab
set show-all-if-ambiguous on

# If multiple completions and no partial completion possible,
# show the list immediately instead of ringing bell
set show-all-if-unmodified on

# Limit on the length of the common prefix for completion display
# If completions share a long common prefix, this prevents truncation
set completion-prefix-display-length 0

# Maximum number of completions to display without prompting
# If more than 200 completions, ask before displaying
set completion-query-items 200

# Don't paginate completions - show all at once
set page-completions off

# Append trailing slash to directories when completing
# Makes it easy to continue typing path immediately
set mark-directories on

# Add a trailing slash to symlinks that resolve to directories
# Helps identify symlinked directories during completion
set mark-symlinked-directories on

# Don't match hidden files unless pattern explicitly starts with '.'
# Reduces clutter in completions unless you specifically want dotfiles
set match-hidden-files off

# Don't expand tilde to home directory on completion
set expand-tilde off

# Skip completed text (intelligent completion insertion)
# If cursor is before text matching completion, don't duplicate
# Example: 'cd ~/src/mozil|la' with cursor at | completes correctly
set skip-completed-text on

# ==============================================================================
# 4. DISPLAY SETTINGS
# ==============================================================================

# Colored completion prefixes based on file type (like ls -F)
# Requires LS_COLORS environment variable for color definitions
set colored-stats on

# Show file type indicators in completion list
# / for directories, * for executables, @ for symlinks, etc.
set visible-stats on

# Add colored prefix to completions based on type
set colored-completion-prefix on

# Disable terminal bell entirely (no audible beep)
# Options: none (off), visible (flash), audible (beep)
set bell-style none

# Show mode indicator in prompt when in vi mode
# Displays [I] for insert mode, [N] for normal/command mode
set show-mode-in-prompt on

# Customize the mode indicator strings with cursor shape changes
# These use ANSI escape codes to change cursor appearance
# \1...\2 wraps non-printing characters for correct prompt length calculation

# Insert mode: blinking bar cursor (|)
set vi-ins-mode-string \1\e[5 q\2

# Command mode: block cursor
set vi-cmd-mode-string \1\e[1 q\2

# Number of screen columns used to display the prompt string
# 0 means calculate automatically
set print-completions-horizontally off

# Don't wrap long lines - let terminal handle it
set horizontal-scroll-mode off

# Echo control characters as ^X (caret notation)
set echo-control-characters on

# ==============================================================================
# 5. HISTORY SETTINGS
# ==============================================================================

# Allow arrow keys to search history based on typed prefix
# Type 'git' then Up arrow to cycle through git commands only
set history-preserve-point on

# Enable 8-bit input/output for UTF-8 support
# Allows Unicode characters without escaping
set input-meta on
set output-meta on

# Don't convert 8-bit characters to escaped format
set convert-meta off

# Disable bracketed paste mode (can cause issues with pasting)
# Set to 'on' if you experience problems pasting multi-line text
set enable-bracketed-paste off

# ==============================================================================
# 6. KEY BINDINGS - Cross-Platform
# ==============================================================================

# ---- Word Navigation ----
# macOS Option+Arrow (sends escape sequences)
"\eb": backward-word
"\ef": forward-word

# Alt+Arrow for various terminals (Linux, Windows Terminal)
"\e\e[C": forward-word
"\e\e[D": backward-word

# xterm-style Alt+Arrow
"\e[1;3C": forward-word
"\e[1;3D": backward-word

# Ctrl+Arrow for Linux terminals
"\e[1;5C": forward-word
"\e[1;5D": backward-word

# ---- Line Navigation ----
# Ctrl+A: Beginning of line (Emacs style, works in vi insert mode)
"\C-a": beginning-of-line

# Ctrl+E: End of line (Emacs style, works in vi insert mode)
"\C-e": end-of-line

# ---- History Navigation ----
# Ctrl+P/N: Previous/next in history (Emacs style)
"\C-p": history-search-backward
"\C-n": history-search-forward

# Up/Down arrows: Search history based on current line prefix
"\e[A": history-search-backward
"\e[B": history-search-forward

# Page Up/Down: Navigate through entire history
"\e[5~": beginning-of-history
"\e[6~": end-of-history

# ---- Editing ----
# Ctrl+W: Delete word before cursor
"\C-w": backward-kill-word

# Ctrl+U: Delete from cursor to beginning of line
"\C-u": unix-line-discard

# Ctrl+K: Delete from cursor to end of line
"\C-k": kill-line

# Alt+Backspace: Delete word before cursor
"\e\C-?": backward-kill-word
"\e\C-h": backward-kill-word

# Alt+D: Delete word after cursor
"\ed": kill-word

# Ctrl+Y: Paste previously deleted text (yank)
"\C-y": yank

# Ctrl+_: Undo last edit
"\C-_": undo

# ---- Completion ----
# Tab: Standard completion
TAB: complete

# Alt+=: List all completions
"\e=": possible-completions

# Alt+?: Also list completions
"\e?": possible-completions

# Alt+*: Insert all completions
"\e*": insert-completions

# ---- Miscellaneous ----
# Ctrl+L: Clear screen (keep current line)
"\C-l": clear-screen

# Ctrl+X Ctrl+E: Edit line in $EDITOR
"\C-x\C-e": edit-and-execute-command

# Ctrl+R: Reverse incremental search (backward)
"\C-r": reverse-search-history

# Ctrl+S: Forward incremental search
"\C-s": forward-search-history

# Insert last argument from previous command
"\e.": insert-last-argument
"\e_": yank-last-arg

# ==============================================================================
# 7. VI MODE SPECIFIC BINDINGS
# ==============================================================================

# Note: These bindings only apply when in vi command mode
# Enter vi mode with Escape, exit with 'i', 'a', 'I', 'A', etc.

$if mode=vi

# ---- Command Mode (vi-cmd-mode) ----
set keymap vi-command

# 'jj' for quick escape from insert mode (handled in insert mode)
# 'v' to edit command in external editor
"v": edit-and-execute-command

# History navigation with j/k
"k": history-search-backward
"j": history-search-forward

# Ctrl+P/N also work in command mode
"\C-p": history-search-backward
"\C-n": history-search-forward

# Go to beginning/end of history
"gg": beginning-of-history
"G": end-of-history

# Clear screen
"\C-l": clear-screen

# ---- Insert Mode (vi-insert-mode) ----
set keymap vi-insert

# 'jj' as alternative Escape (common vim mapping)
# Type 'jj' quickly to exit insert mode
"jj": vi-movement-mode

# Ctrl+P/N for history search in insert mode
"\C-p": history-search-backward
"\C-n": history-search-forward

# Up/Down arrows also search
"\e[A": history-search-backward
"\e[B": history-search-forward

# Quick navigation without leaving insert mode
"\C-a": beginning-of-line
"\C-e": end-of-line

# Clear screen in insert mode
"\C-l": clear-screen

# Word deletion
"\C-w": backward-kill-word

$endif

# ==============================================================================
# APPLICATION-SPECIFIC SETTINGS
# ==============================================================================

# Settings specific to Bash
$if Bash
    # Enable completion for sudo (completes as if sudo wasn't there)
    Space: magic-space
$endif

# Settings specific to Python REPL
$if Python
    # Enable history search in Python
    "\C-p": history-search-backward
    "\C-n": history-search-forward
$endif

# ==============================================================================
# TERMINAL-SPECIFIC SETTINGS
# ==============================================================================

# iTerm2 on macOS
$if term=xterm-256color
    # Map Option+Arrow to word navigation
    "\e[1;9C": forward-word
    "\e[1;9D": backward-word
$endif

# ==============================================================================
# LOCAL OVERRIDES
# ==============================================================================
# Create ~/.inputrc.local for machine-specific settings

$include ~/.inputrc.local
