# ==============================================================================
# Git Configuration
# ==============================================================================
# Merged from top GitHub dotfiles and Git communities:
# - Julia Evans' git config survey (jvns.ca)
# - mathiasbynens/dotfiles (30k+ stars)
# - jessfraz/dotfiles - Developer-focused settings
# - thoughtbot/dotfiles - Sensible defaults
# - paulirish/dotfiles - Performance optimizations
#
# Organization:
#   1. User - Identity settings
#   2. Core - Fundamental Git behavior
#   3. Init - Repository initialization
#   4. Commit - Commit message settings
#   5. Push/Pull/Fetch - Remote operations
#   6. Merge/Rebase - Branch integration
#   7. Diff - Viewing changes
#   8. Color - Terminal colors
#   9. Aliases - Custom shortcuts
#  10. Tools - External programs
#  11. URL Shortcuts - Repository URL handling
#  12. Includes - Conditional configs
# ==============================================================================

# ==============================================================================
# 1. USER IDENTITY
# ==============================================================================

[user]
    # Primary identity - override per-repo or with includeIf below
    name = Jay Ovalle
    email = jay.ovalle@gmail.com
    user = jovalle

    # Sign commits with SSH key (modern alternative to GPG)
    # Enable with: git config --global user.signingkey ~/.ssh/id_ed25519.pub
    # signingkey = ~/.ssh/id_ed25519.pub

# ==============================================================================
# 2. CORE SETTINGS
# ==============================================================================

[core]
    # Default editor for commit messages
    # Falls back to VISUAL or EDITOR environment variables
    editor = vim

    # Properly display Unicode filenames
    # Without this, non-ASCII filenames show as \xxx sequences
    quotepath = false

    # Line ending handling - critical for cross-platform teams
    # 'input': Convert CRLF to LF on commit, leave LF as-is on checkout
    # (Recommended for Unix/macOS, avoids CRLF issues)
    autocrlf = input

    # Treat whitespace issues as errors
    # 'fix': Auto-fix trailing whitespace and space-before-tab
    # '-indent-with-non-tab': Allow mixed tabs/spaces
    whitespace = fix,-indent-with-non-tab,trailing-space,cr-at-eol

    # Allow symlinks in the working directory
    symlinks = true

    # Global gitignore for all repositories
    # Contains patterns like .DS_Store, Thumbs.db, *.swp, .env
    excludesfile = ~/.gitignore_global

    # Improve performance for large repositories
    # Use mmap for reading pack files (faster for large repos)
    packedGitLimit = 512m
    packedGitWindowSize = 512m

    # Detect file moves/renames in diff (helpful for refactoring)
    # Requires more memory but produces cleaner diffs
    # Values: true, false, or threshold (e.g., "50%")
    renameLimit = 3000

    # Use pager for long output (respects LESS environment variable)
    pager = less -RFX

    # Preload index for faster operations
    preloadIndex = true

    # Use filesystem monitor for improved performance on large repos (Git 2.37+)
    # Uncomment on systems with fsmonitor support
    # fsmonitor = true
    # untrackedCache = true

# ==============================================================================
# 3. INIT - Repository Initialization
# ==============================================================================

[init]
    # Use 'main' as the default branch name (modern standard)
    # Replaces legacy 'master' branch name
    defaultBranch = main

    # Template directory for new repositories
    # Can include hooks, gitattributes, README templates
    # templateDir = ~/.git-templates

# ==============================================================================
# 4. COMMIT - Commit Message Settings
# ==============================================================================

[commit]
    # Show diff in commit message editor
    # Helps write better commit messages by seeing the exact changes
    verbose = true

    # Use 'scissors' cleanup mode
    # Allows '#include' in commit messages (useful for linking docs)
    # Lines below scissors marker are removed
    cleanup = scissors

    # Sign all commits with configured signing key
    # Requires user.signingkey to be set
    # gpgsign = true

[gpg]
    # Use SSH keys for signing instead of GPG
    # Simpler setup, keys already exist for authentication
    format = ssh

[gpg "ssh"]
    # Configure allowed signers for verification
    # allowedSignersFile = ~/.ssh/allowed_signers

# ==============================================================================
# 5. PUSH / PULL / FETCH - Remote Operations
# ==============================================================================

[push]
    # 'simple': Push current branch to upstream if names match (default, safest)
    # 'current': Always push to same-named remote branch (convenient)
    default = simple

    # Automatically set upstream on first push
    # Eliminates need for: git push -u origin branch-name
    autoSetupRemote = true

    # Push annotated tags with commits automatically
    # Useful for version tags (v1.0.0, etc.)
    followTags = true

    # Push submodule changes automatically when pushing superproject
    # recurseSubmodules = on-demand

[pull]
    # Rebase local commits on top of upstream changes instead of merging
    # Creates cleaner, linear history
    rebase = true

    # Only allow fast-forward pulls (alternative to rebase = true)
    # Prevents accidental merge commits; use explicit merge when needed
    # ff = only

[fetch]
    # Remove remote-tracking refs for deleted remote branches
    # Keeps local repo clean when branches are deleted on remote
    prune = true

    # Also prune deleted tags from remotes
    pruneTags = true

    # Verify transferred objects for data integrity
    # Small performance cost but catches corruption early
    fsckobjects = true

    # Write commit graph for faster operations (Git 2.18+)
    writeCommitGraph = true

    # Fetch submodules in parallel
    parallel = 0

[remote "origin"]
    # Automatically prune when fetching from origin
    prune = true

# ==============================================================================
# 6. MERGE / REBASE - Branch Integration
# ==============================================================================

[merge]
    # Default merge tool (for resolving conflicts)
    tool = vimdiff

    # Show 3-way diff in conflicts (zdiff3 shows the original, Git 2.35+)
    # Much easier to resolve conflicts when you can see the original text
    # Options: merge (default), diff3, zdiff3 (best)
    conflictstyle = zdiff3

    # Don't keep .orig backup files after merge
    keepbackup = false

    # Always create merge commit, even for fast-forward merges
    # Preserves branch history (useful for feature branches)
    # ff = false

[mergetool]
    # Don't prompt before each file in mergetool
    prompt = false

    # Don't keep backup files after successful merge
    keepBackup = false

[rebase]
    # Automatically stash/unstash changes when rebasing
    # Allows rebase with dirty working directory
    autoStash = true

    # Automatically squash commits starting with "fixup!" or "squash!"
    # Works with: git commit --fixup=<commit>
    autoSquash = true

    # Warn if commits are dropped during interactive rebase
    # Prevents accidental commit deletion
    missingCommitsCheck = error

    # Update refs when rebasing stacked branches (Git 2.38+)
    # Automatically updates dependent branches during rebase
    updateRefs = true

    # Use 'merge' backend for rebase (more features, Git 2.22+)
    backend = merge

[rerere]
    # REuse REcorded REsolution - remember how you resolved conflicts
    # Automatically reapplies the same resolution next time
    enabled = true

    # Auto-stage files resolved by rerere
    autoUpdate = true

# ==============================================================================
# 7. DIFF - Viewing Changes
# ==============================================================================

[diff]
    # External diff tool for graphical diffs
    tool = vimdiff

    # Use histogram algorithm for diffs
    # Better handling of moved/reordered code blocks
    # Options: default, minimal, patience, histogram (best)
    algorithm = histogram

    # Detect renames in diffs
    renames = copies

    # Show moved lines with different colors
    # Makes it easy to spot code that was moved vs. added/deleted
    colorMoved = default

    # Ignore indentation changes when detecting moved lines
    colorMovedWS = allow-indentation-change

    # Show more context around changes (default: 3)
    context = 5

    # Indent heuristic for better alignment of diff output
    indentHeuristic = true

    # Show submodule changes as a log of commits
    submodule = log

    # Use mnemonic prefixes in diff output
    # 'i' for index, 'w' for worktree instead of 'a' and 'b'
    mnemonicPrefix = true

[difftool]
    # Don't prompt before launching difftool
    prompt = false

# ==============================================================================
# 8. COLOR - Terminal Colors
# ==============================================================================

[color]
    # Auto-detect color support
    ui = auto

    # Pagination output should be colored
    pager = true

[color "branch"]
    current = yellow reverse bold
    local = yellow
    remote = green
    upstream = blue

[color "diff"]
    meta = yellow bold
    frag = magenta bold
    old = red bold
    new = green bold
    commit = yellow bold
    whitespace = red reverse

[color "status"]
    added = green bold
    changed = yellow bold
    untracked = cyan
    branch = yellow bold

[color "diff-highlight"]
    # Fine-grained diff highlighting (word-level changes)
    oldNormal = red bold
    oldHighlight = red bold 52
    newNormal = green bold
    newHighlight = green bold 22

# ==============================================================================
# 9. ALIASES - Custom Shortcuts
# ==============================================================================

[alias]
    # ---- Status & Info ----
    s = status -sb                           # Short status with branch info
    st = status                              # Full status
    info = remote show origin                # Show remote info

    # ---- Branches ----
    br = branch -av                          # All branches (local + remote)
    brs = branch --sort=-committerdate       # Branches sorted by recent activity
    co = checkout                            # Checkout shorthand
    cb = checkout -b                         # Create and checkout branch
    sw = switch                              # Modern checkout alternative
    swc = switch -c                          # Create and switch to branch
    bd = branch -d                           # Delete merged branch
    bD = branch -D                           # Force delete branch

    # ---- Commits ----
    c = commit                               # Commit
    cm = commit -m                           # Commit with message
    ca = commit --amend                      # Amend last commit
    can = commit --amend --no-edit           # Amend without changing message
    caf = commit --amend --no-edit --all     # Amend with all changes
    fix = commit --fixup                     # Create fixup commit

    # ---- Staging ----
    a = add                                  # Add files
    aa = add --all                           # Add all changes
    ap = add --patch                         # Interactive staging
    unstage = reset HEAD --                  # Unstage files

    # ---- Diffs ----
    d = diff                                 # Working directory changes
    ds = diff --staged                       # Staged changes
    dc = diff --cached                       # Alias for --staged
    dw = diff --word-diff                    # Word-level diff
    stat = diff --stat                       # Summary of changes

    # ---- Log & History ----
    l = log --oneline -20                    # Short log
    lg = log --oneline --graph --decorate    # Graph log
    lga = log --oneline --graph --all        # Graph log all branches
    ll = log --pretty=format:'%C(yellow)%h%C(reset) %C(blue)%ad%C(reset) %C(green)%an%C(reset) %s%C(red)%d%C(reset)' --date=short
    last = log -1 HEAD --stat                # Last commit with stats
    who = shortlog -sne                      # Contributors ranked by commits
    today = log --since=midnight --oneline   # Today's commits

    # ---- Undoing ----
    undo = reset --soft HEAD~1               # Undo last commit (keep changes)
    uncommit = reset HEAD~1                  # Undo commit, unstage changes
    discard = checkout --                    # Discard file changes
    wipe = reset --hard HEAD                 # Discard all changes

    # ---- Remote Operations ----
    p = push                                 # Push
    pf = push --force-with-lease             # Safe force push
    pl = pull                                # Pull
    f = fetch --all --prune                  # Fetch all remotes
    sync = !git fetch --all --prune && git pull --rebase

    # ---- Stashing ----
    ss = stash save                          # Stash with message
    sp = stash pop                           # Pop stash
    sl = stash list                          # List stashes
    sd = stash drop                          # Drop stash
    sa = stash apply                         # Apply without dropping

    # ---- Rebasing ----
    rb = rebase                              # Rebase
    rbi = rebase -i                          # Interactive rebase
    rbc = rebase --continue                  # Continue rebase
    rba = rebase --abort                     # Abort rebase
    rom = rebase origin/main                 # Rebase onto origin/main

    # ---- Merging ----
    m = merge                                # Merge
    mnf = merge --no-ff                      # Merge with merge commit
    ma = merge --abort                       # Abort merge

    # ---- Worktrees ----
    wt = worktree                            # Worktree commands
    wta = worktree add                       # Add worktree
    wtl = worktree list                      # List worktrees

    # ---- Utilities ----
    aliases = config --get-regexp alias      # List all aliases
    root = rev-parse --show-toplevel         # Show repo root directory
    ignore = "!gi() { curl -sL https://www.toptal.com/developers/gitignore/api/$@ ;}; gi"
    contributors = shortlog --summary --numbered
    count = rev-list --count HEAD            # Count commits

    # ---- Finding Things ----
    find = "!git ls-files | grep -i"         # Find file by name
    grep = grep -Ii                          # Case-insensitive grep
    search = log -p -S                       # Search commit content

    # ---- Cleanup ----
    cleanup = "!git branch --merged | grep -v '\\*\\|main\\|master' | xargs -n 1 git branch -d"
    prune-local = "!git fetch -p && git branch -vv | grep ': gone]' | awk '{print $1}' | xargs git branch -d"

# ==============================================================================
# 10. TOOLS - External Programs
# ==============================================================================

[log]
    # Default date format for logs
    date = iso

    # Show ref names (branches, tags) with commits
    decorate = short

[blame]
    # Show relative dates in blame output
    date = relative

    # Color blame output by age of commits
    coloring = repeatedLines

    # File listing commits to ignore during blame
    # Useful for ignoring formatting commits
    # ignoreRevsFile = .git-blame-ignore-revs

[status]
    # Show summary of changes in submodules
    submoduleSummary = true

    # Show untracked files in directories (faster)
    showUntrackedFiles = all

[branch]
    # Sort branches by most recent commit
    sort = -committerdate

[tag]
    # Sort tags by date
    sort = -taggerdate

[help]
    # Auto-correct typos after 1 second (10 = 1 second)
    autocorrect = 10

[advice]
    # Hide common advice messages (for experienced users)
    statusHints = false
    commitBeforeMerge = false
    detachedHead = false

# ==============================================================================
# 11. URL SHORTCUTS - Repository URL Handling
# ==============================================================================

[url "git@github.com:"]
    # Use SSH instead of HTTPS for GitHub (faster, no password prompts)
    insteadOf = https://github.com/
    pushInsteadOf = https://github.com/

[url "git@gitlab.com:"]
    # Use SSH instead of HTTPS for GitLab
    insteadOf = https://gitlab.com/
    pushInsteadOf = https://gitlab.com/

[url "git@bitbucket.org:"]
    # Use SSH instead of HTTPS for Bitbucket
    insteadOf = https://bitbucket.org/
    pushInsteadOf = https://bitbucket.org/

# ==============================================================================
# 12. INCLUDES - Conditional Configurations
# ==============================================================================

# Work-specific settings (email, signing key, etc.)
# [includeIf "gitdir:~/work/"]
#     path = ~/.gitconfig-work

# Personal projects settings
# [includeIf "gitdir:~/projects/"]
#     path = ~/.gitconfig-personal

# Git LFS (Large File Storage) settings
[filter "lfs"]
    required = true
    clean = git-lfs clean -- %f
    smudge = git-lfs smudge -- %f
    process = git-lfs filter-process

# ==============================================================================
# LOCAL OVERRIDES
# ==============================================================================
# Create ~/.gitconfig.local for machine-specific settings

[include]
    path = ~/.gitconfig.local
