---
# yaml-language-server: $schema=https://taskfile.dev/schema.json

tasks:

  configure:
    cmds:
      - task: configure-sudoers
      - task: enable-services
      - cmd: |
          if grep -qi microsoft /proc/version; then
            task wsl:configure
          fi
    desc: Configure Linux and WSL-specific settings

  configure-sudoers:
    cmd: "{{.ROOT_DIR}}/scripts/linux/configure-sudoers.sh"

  default:
    cmds:
      - task: configure
      - task: install

  enable-services:
    cmd: brew services start {{range .services}}{{.}} {{end}}
    status:
      - test -z "{{.services}}"

  install:
    cmds:
      - task: install-packages
      - task: install-pip-packages
      - cmd: |
          if grep -qi microsoft /proc/version; then
            task wsl:install
          fi

  install-pip-packages:
    cmd: pipx install {{range .pip_packages}}{{.}} {{end}}
    status:
      - test -z "{{.pip_packages}}"

  install-packages:
    cmds:
      - task: update
      - cmd: sudo apt install -y {{range .packages}}{{.}} {{end}}
    requires:
      vars:
        - packages

  update:
    cmd: sudo apt update

  upgrade:
    cmds:
      - task: update
      - cmd: sudo apt upgrade -y

vars:
  formulae:
    - helm
    - k9s
    - kind
    - kubectl
    - neofetch
    - sops
    - syncthing
    - terraform
  packages:
    - ansible
    - btop
    - build-essential
    - cifs-utils
    - dkms
    - fzf
    - git
    - glances
    - grc
    - htop
    - libbz2-dev
    - libffi-dev
    - libgdbm-dev
    - libncurses5-dev
    - libnss3-dev
    - libreadline-dev
    - libsqlite3-dev
    - libssl-dev
    - make
    - neovim
    - net-tools
    - npm
    - nvme-cli
    - pipx
    - python3
    - python3-pip
    - ripgrep
    - rsync
    - s-tui
    - stow
    - wget
    - zlib1g-dev
    - zsh
  pip_packages:
    - commitizen
    - pre-commit
  services:
    - syncthing

version: 3
